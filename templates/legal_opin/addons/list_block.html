{% load static %}
<link rel="stylesheet" href="{% static 'legal_opin/css/main.css' %}">
<script src="{% static 'legal_opin/js/entity_main.js' %}"></script>

<div class="scrollable legal-entities-container" style="height: 77vh; overflow-y: auto;">
    <!-- Индикатор загрузки -->
    <div id="loading-indicator" class="text-center py-3" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Загрузка...</span>
        </div>
        <p class="text-muted mt-2">Загружаем дополнительные данные...</p>
    </div>
    
    <!-- Контейнер для юридических лиц -->
    <div id="entities-container">
        {% for entity in legal_entities %}
        <div class="card mb-3 shadow-sm position-relative entity-card"
             data-legal-form="{{ entity.legal_form }}" 
             data-status="{{ entity.status }}"
             data-created-date="{{ entity.created_at|date:'Y-m-d' }}"
             data-updated-date="{{ entity.updated_at|date:'Y-m-d' }}"
             data-entity-name="{{ entity.name|lower }}"
             data-entity-inn="{{ entity.inn|default:'' }}"
             data-entity-ogrn="{{ entity.ogrn|default:'' }}">
            <div class="card-body">
                <div class="status-line mb-2">
                    <small class="text-muted">
                        <span class="entity-meta">
                            <span class="badge rounded-pill bg-primary">{{ entity.legal_form }}</span>
                        </span>
                        <span style="margin-right: 0.1rem; margin-left: 0.1rem"></span>
                        <span class="created-date">| Создано {{ entity.created_at|date:"d.m.Y" }}</span>
                    </small>
                </div>
                <h5 class="card-title fw-bold entity-name">{{ entity.name }}</h5>
                <div class="entity-details">
                    <p class="card-text mb-1">
                        <strong>ИНН:</strong> 
                        <span class="entity-inn">{{ entity.inn }}</span>
                        <button class="btn btn-sm btn-outline-secondary copy-btn" data-copy="{{ entity.inn }}" title="Копировать ИНН">
                            <img src="{% static 'img/copy.svg' %}" alt="copy" class="copy-icon" width="16" height="16">
                        </button>
                        <span class="ms-3"><strong>ОГРН:</strong> 
                        <span class="entity-ogrn">{{ entity.ogrn }}</span>
                        <button class="btn btn-sm btn-outline-secondary copy-btn" data-copy="{{ entity.ogrn }}" title="Копировать ОГРН">
                            <img src="{% static 'img/copy.svg' %}" alt="copy" class="copy-icon" width="16" height="16">
                        </button>
                        </span>
                    </p>
                    <p class="text-muted small mb-1">
                        <strong>Обновлено:</strong> {{ entity.updated_at|date:"d.m.Y H:i" }}
                    </p>
                </div>
                <a href="{% url 'legal_opin:legal_entity_detail' entity.pk %}" class="stretched-link"></a>
            </div>
        </div>
        {% empty %}
        <p class="text-muted">Нет доступных юридических лиц.</p>
        {% endfor %}
    </div>
</div>