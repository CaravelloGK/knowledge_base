<div class="legal-opin-content">
    <div class="pt-4">
        <h2 class="fw-bold mb-1" style="font-size:2.2rem;">Юридические лица</h2>
        <div class="text-muted mb-4" style="font-size:1rem;">
            Просматривайте ранее добавленные юридические лица
        </div>
        <div class="d-flex align-items-center gap-3 mb-3 flex-wrap">
            <!-- Поле поиска -->
            <div class="input-group search-group" style="max-width: 350px;">
                <span class="input-group-text search-addon">
                    <i class="bi bi-search"></i>
                </span>
                <input type="text" name="query" class="form-control search-field" placeholder="Поиск" aria-label="Поиск">
            </div>
        </div>

        <!-- Индикатор загрузки -->
        <div id="loading-indicator" class="text-center py-3" style="display: none;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Загрузка...</span>
            </div>
            <p class="text-muted mt-2">Загружаем дополнительные данные...</p>
        </div>

        <div class="table-container" style="height: 600px; overflow-y: auto; overflow-x: auto;">
            <table class="table align-middle mb-0" style="min-width: 600px;">
                <thead style="background: #f7f9fb; position: sticky; top: 0; z-index: 10;">
                    <tr style="border-bottom: 2px solid #e3e6ea;">
                        <th class="py-3 px-3" style="font-weight: 500;">#</th>
                        <th class="py-3 px-3" style="font-weight: 500;">Название</th>
                        <th class="py-3 px-3" style="font-weight: 500;">ИНН</th>
                        <th class="py-3 px-3" style="font-weight: 500;">ОГРН</th>
                        <th class="py-3 px-3" style="font-weight: 500;">Дата обновления</th>
                    </tr>
                </thead>
                <tbody id="entities-container">
                    {% for entity in legal_entities %}
                    <tr class="entity-item" 
                        data-name="{{ entity.name|lower }}"
                        data-inn="{{ entity.inn }}"
                        data-ogrn="{{ entity.ogrn }}"
                        data-update-date="{{ entity.updated_at|date:'Y-m-d' }}"
                        style="border-bottom: 1px solid #f0f0f0;">
                        <td class="py-3 px-3">{{ forloop.counter }}</td>
                        <td class="py-3 px-3">
                            <a href="{% url 'legal_opin:legal_entity_detail' entity.pk %}" class="text-decoration-none text-primary entity-name">{{ entity.name }}</a>
                        </td>
                        <td class="py-3 px-3 entity-inn">{{ entity.inn }}</td>
                        <td class="py-3 px-3 entity-ogrn">{{ entity.ogrn }}</td>
                        <td class="py-3 px-3 entity-date">{{ entity.updated_at|date:"d.m.Y" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center text-muted py-4">Нет юридических лиц.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Передаем данные через data-атрибуты -->
<div id="legal-entities-data" 
     data-total-count="{{ total_count|default:0 }}"
     data-loaded-count="{{ loaded_count|default:0 }}"
     data-has-more="{% if has_more %}true{% else %}false{% endif %}"
     style="display: none;"></div>

<!-- Optionally include Bootstrap Icons for the search icon -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">