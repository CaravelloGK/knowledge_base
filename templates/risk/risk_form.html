{% extends 'index.html' %}
{{ form.media }}
<!--подключаем основной шаблон-->
{% block content %}
<div class="review-form-page">
 <div class="container mt-5" style="max-width: 1550px;">
    <form method="post" class="needs-validation">
      {% csrf_token %}
      {{ form.media }}
       <div class="row ms-5">
           <div>
            {{ form.as_p }}
          </div>
    
       </div>
       <button type="submit" class="btn btn-primary">Опубликовать</button>
       {% if back %}
           <a href="{% url 'risk:risk_detal' rsk.pk %}" class="btn btn-primary">Отмена</a>
       {% else %}
           <a href="{% url 'risk:risk_main' %}" class="btn-clear">Отмена</a>
       {% endif %}
    </form>
 </div>
</div>

<!-- Подключение Bootstrap JS (необходим для валидации) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Скрипт валидации формы -->
{#<script>#}
{#(function () {#}
{#  'use strict';#}
{#  // Находим все формы с классом needs-validation#}
{#  var forms = document.querySelectorAll('.needs-validation');#}
{#  // Делаем валидацию#}
{#  Array.prototype.slice.call(forms)#}
{#    .forEach(function (form) {#}
{#      form.addEventListener('submit', function (event) {#}
{#        // Если форма невалидна, отменяем отправку#}
{#        if (!form.checkValidity()) {#}
{#          event.preventDefault()#}
{#          event.stopPropagation()#}
{#        }#}
{#        // Добавляем класс was-validated, чтобы Bootstrap отобразил invalid-feedback#}
{#        form.classList.add('was-validated')#}
{#      }, false)#}
{#    });#}
{#})();#}
{#</script>#}

<script>
document.addEventListener('DOMContentLoaded', function() {
  const nameTextarea = document.getElementById('id_name');
  if (!nameTextarea) return;

  // Функция, которая подгоняет высоту текстового поля к содержимому
  function autoExpand(el) {
    el.style.height = 'auto';
    const baseHeightPx = 40;
    const newHeight = Math.max(el.scrollHeight, baseHeightPx);
    el.style.height = newHeight + 'px';
  }

  // При каждом вводе символа в textarea
  nameTextarea.addEventListener('input', function() {
    autoExpand(this);
  });

  // Подстраиваем сразу при загрузке
  autoExpand(nameTextarea);
});
</script>

{% endblock %}
